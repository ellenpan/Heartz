<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>The math behind Heartz</title>
    <style>
      :root{
        --bg:#161616;
        --fg:#ffffff;
        --nav-height:56px;
      }

      *{ box-sizing:border-box; }

      html,body{
        height:100%;
        margin:0;
        background:var(--bg);
        color:var(--fg);
        font-family: Arial, Helvetica, sans-serif;
      }

      /* NAV */
      nav {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: var(--nav-height);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 18px;
        background: var(--bg);
        z-index: 1000;
        border-bottom: 1px solid rgba(255, 255, 255, 0.283);
      }

      nav .brand {
        font-weight: 600;
        letter-spacing: 0.5px;
      }

      nav .links {
        display: flex;
        gap: 16px;
      }

      nav a {
        color: var(--fg);
        text-decoration: none;
        font-size: 14px;
        opacity: 0.95;
      }

      nav a:hover{ opacity: 1; }

      main{
        height: 100%;
        padding-top: var(--nav-height);
      }

      /* Centered, scrollable text container (no box) */
      .center-wrap{
        height: calc(100vh - var(--nav-height));
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 28px 18px;
      }

      .content{
        width: min(900px, 92vw);
        max-height: calc(100vh - var(--nav-height) - 56px);
        overflow-y: auto;
        padding: 0;
        line-height: 1.55;
      }

      h1{
        margin: 0 0 14px 0;
        font-size: 36px;
        letter-spacing: 0.2px;
      }

      p{
        margin: 0 0 14px 0;
        font-size: 15px;
        opacity: 0.97;
      }

      ol{
        margin: 8px 0 0 20px;
        padding: 0;
      }

      li{
        margin: 10px 0;
        font-size: 15px;
        opacity: 0.97;
      }

      /* subtle scrollbar only */
      .content::-webkit-scrollbar{ width: 10px; }
      .content::-webkit-scrollbar-thumb{
        background: rgba(255,255,255,0.22);
        border-radius: 999px;
      }
      .content::-webkit-scrollbar-track{
        background: transparent;
      }
    </style>
  </head>

  <body>
    <nav role="navigation" aria-label="Main navigation">
      <div class="brand"></div>
      <div class="links">
        <a href="index.html">Home</a>
        <a href="math.html">How it works</a>
        <a href="https://ellenpan.com" target="_blank" rel="noopener noreferrer">
          ellenpan.com
        </a>
      </div>
    </nav>

    <main>
      <div class="center-wrap">
        <div class="content">
          <h1>The math behind Heartz</h1>

          <p>
            Soundwaves can be visualized by a Fast Fourier Transform (FFT), which decomposes the sound signal into its frequencies (pitch) and respective amplitudes (volume). This results in the “mountains and valleys” that we commonly see in waveform visualizations.
          </p>

          <p>
            To create the 2D waveform ring, an invisible hand traces once around a reference circle throughout your 5-second audio clip. During this time, 360 sound samples are taken. based on the frequency and amplitude at each timestamp, a dot is plotted at a calculated distance away from the center of the reference circle at the corresponding angle. Each new dot is connected to the previous one by a straight line, and the complete set of dots creates a preliminary circular waveform with mountains and valleys depending on the dots’ varied distances away from the center.
          </p>

          <p>
            To make the circular waveform less jagged and take on more of a sine/cosine wave appearance, a Catmull-Rom smoothing algorithm is used to approximate curves between the set of dots. This waveform is stored for the next step: transformation to 3D mesh.
          </p>

          <p>Three.js is used to create the mesh using the following logic:</p>

          <ol>
            <li>
              Consider the 2D loop to be set flat on the X-Y plane. A copy of the loop is created, and it is shrunk towards the center on the plane to 25% the size of the original. We now have two concentric loops.
            </li>
            <li>
              Points in the perimeter of the outer loop are raised or lowered along the Z axis depending on their distance from the center. Points closest to/farthest from the center are lowered/raised by 1 unit respectively. All intermediary points are raised/lowered proportionally along the z axis. The same procedure is performed on the inner 2D loop at a reduced intensity. Then, each point on the perimeters of the two loops are connected to their concentric counterpart. This creates a waved “donut” shape that you see in the final mesh.
            </li>
            <li>
              Four levels of the Catmull-Clark subdivision surface algorithm is applied to this mesh to give it rounded corners. It is then solidified to ensure proper thickness for 3D printing. Finally, a metallic material and smooth modifier are applied to the whole object to give it its shiny appearance. You may have also noticed the blue and yellow directional lights that it’s reflecting!
            </li>
          </ol>
        </div>
      </div>
    </main>
  </body>
</html>
